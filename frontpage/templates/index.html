{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link rel="stylesheet" href="{% static '/css/materialize.css' %}">
    <link rel="stylesheet" href="{% static '/css/styles.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>BandMap</title>
</head>
<body>
    <style>
    @font-face {
        font-family: "Exo";
        src: url("{% static 'fonts/Exo-VariableFont_wght.ttf'%}");
    }

    .popup-intro {
        background: gray;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        visibility: hidden;
        opacity: 0;
        transition: .7s ease-in;
        align-items: center;
        justify-content: center;
        scrollbar-color: black #1a237e;
        scrollbar-width: auto;
    }

    .popup-intro-content {
        position: relative;
        width: 700px;
        height: 530px;
        border-radius: 10px;
        background: rgb(2,0,36);
        background: -moz-linear-gradient(180deg, rgba(2,0,36,1) 3%, rgba(197,205,255,1) 80%, rgba(138,143,189,0) 100%);
        background: -webkit-linear-gradient(180deg, rgba(2,0,36,1) 3%, rgba(197,205,255,1) 80%, rgba(138,143,189,0) 100%);
        background: linear-gradient(180deg, rgba(2,0,36,1) 3%, rgba(197,205,255,1) 90%, rgba(138,143,189,0) 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#020024",endColorstr="#8a8fbd",GradientType=1);
        visibility: hidden;
        opacity: 0;
        overflow: auto;
        transition: .7s ease-in;
        color: white;
        scrollbar-color: black #1a237e;
        scrollbar-width: auto;
    }

    .popup-intro-content.activate {
        visibility: visible;
        opacity: 1;
    }

    .popup-intro.activate {
        visibility: visible;
        opacity: .9;
    }

    .popup-links {
        color: #268c4a;
    }

    .popup-success {
        top: 50px;
        left: 500px;
        position: fixed;
        width: 480px;
        height: 100px;
        border-radius: 13px;
        background: black;
        visibility: hidden;
        opacity: 0;
        overflow: auto;
        transition: 1s ease-in;
    }

    .popup-success.activate {
        visibility: visible;
        opacity: .75;
    }
    </style>
    
    
    {% csrf_token %}
    {{location|json_script:'loc'}}
    {{geo|json_script:'geojson'}}
    {{sp_token|json_script:'sp_token'}}
    {{mapbox|json_script:'token'}}

    <div id='map-container'></div>

    <div class='popup-success' id='success'>
        <div class='row center'>
            <h4 class='primary'>Your playlist is ready!</h4>
        </div>
    </div>

    <div class='popup-intro' id='intro'>
        <div class='popup-intro-content' id='intro'>
            <div class='row center'>
                <div class='col s12'>
                {% if not first_visit %}
                    <ul class='tabs tabs-fixed-width z-depth-1'>
                        <li class='tab col s3'><a href='#welcome-tab'>Weclome</a></li>
                        <li class='tab col s3'><a href='#info-tab'>Info</a></li>
                        <li class='tab col s3'><a href='#options-tab'>Options</a></li>
                        <li class='tab col s3'><a href='#sources-tab'>Sources</a></li>
                        <li class='tab col s3'><a href='#contact-tab'>Contact</a></li>
                    </ul>
                {% endif %}
                </div>
            </div>
            <div class='container' id='welcome-tab'>
                <div class='row center'>
                    <header class='header'>
                        <h1 class='primary' style='text-shadow: 2px 2px 5px black; font-family: "Exo";'>Welcome To BandMap!</h1>
                        <h5 style='color: #8B2635'><b>A way to explore Bandcamp on a map.</h5></b>
                        {% if first_visit %}
                        <div class='row'>
                            To begin, press start.
                        </div>
                        <div class='row'>
                            <div class='col6'>
                                <a class='green waves-effect btn' href='#' id='myLocation'>Start</a>
                            </div>
                        </div>
                        {% else %}
                            <p>On BandMap, each circle represents a city. The more artists there are in the city, the bigger the circle.
                            Hovering over a city will let you know how many artists there are and which genres are most popular to make 
                            in that city (not based on listener habits).</p>
                            <p>In the Info tab you will find more details on what the menu buttons do. Go to options to filter which kinds of artists 
                            populate the map, and choose the style of the map.</p>
                        {% endif %}
                    </header>
                </div>
            </div>
            {% if not first_visit %}
                <div class='container' id='info-tab'>
                    {% include 'includes/info.html' %}
                </div>
                <div class='container' id='options-tab'>
                    {% include 'includes/options.html' %}
                </div>
                <div class='container' id='sources-tab'>
                    {% include 'includes/sources.html' %}
                </div>
                <div class='container' id='contact-tab'>
                    {% include 'includes/contact.html' %}
                </div>
            {% endif %}
        </div>
    </div>

    <div id='sideFeats' class='sidebar'>
        {% csrf_token %}
        <div id='city'></div>
        <ul id='artists' class='collapsible popout'></ul>
    </div>

    <div class='fixed-action-btn'>
        <a href='#' class='btn-floating btn-large pulse indigo darken-4'>
        <i class='large material-icons'>menu</i>
        </a>
        {% include 'includes/buttons.html' %}
    <div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> 
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css" type="text/css">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <script src="{% static '/js/map.js' %}"></script>

    <script>


        document.addEventListener('mousemove', function(e) {
            document.querySelector('.popup-intro-content').style.backgroundImage = `linear-gradient(${e.target.movementX}`
        })

        // close sidenav button
        function closeNav() {
            $('#sideFeats').css('width', '0');
            $('#map-container').css('left','0')
        }
        // auto init materialize js
        M.AutoInit();

        // info modal control
        function popupIntro() {
            if ($('#intro').hasClass('activate')) {
                $('.popup-intro, .popup-intro-content').removeClass('activate')
            } else {
                $('.popup-intro, .popup-intro-content').addClass('activate')
            }
        };

        $('#open-intro').click(popupIntro);

        document.addEventListener("click", function(e) {
        if (e.target == document.querySelector(".popup-intro.activate") || e.target == document.querySelector('.popup-success.activate')) {
            document.querySelector(".popup-intro.activate").classList.remove('activate');
            document.querySelector('.popup-intro-content').classList.remove('activate');
            document.querySelector('.popup-success.activate').classList.remove('activate');
        }
        });


    </script>
</body>
</html>